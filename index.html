<!doctype html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>روزنامه دیواری فارسی – نسخه جامع پژوهشی</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700;800&display=swap" rel="stylesheet" />
    <style>
      :root {
        --bg-a: #dff6f2;
        --bg-b: #d7ebf8;
        --bg-c: #f4fbf9;
        --ink: #113f38;
        --line: #2e8c6b;
        --card: #ffffffde;
      }
      * { box-sizing: border-box; }
      html, body {
        margin: 0;
        font-family: "Vazirmatn", sans-serif;
        color: var(--ink);
        background: linear-gradient(145deg, var(--bg-a), var(--bg-b), var(--bg-c));
      }
      .container { width: min(1320px, 95%); margin: 0 auto; }
      header { text-align: center; padding: 2rem 0 1rem; }
      h1 { margin: 0; font-size: clamp(1.6rem, 4vw, 2.8rem); }
      .subtitle { margin: .8rem auto 0; max-width: 1000px; line-height: 2; }

      .search-global {
        width: min(800px, 100%);
        margin: 1rem auto 1.2rem;
        display: block;
        border: 2px solid #a9d8ce;
        border-radius: 12px;
        padding: .75rem .9rem;
        font: inherit;
        background: #fff;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 1rem;
        padding-bottom: 1.6rem;
      }
      .card {
        background: var(--card);
        border: 2px solid var(--line);
        border-radius: 12px;
        box-shadow: 0 10px 24px rgba(17,75,64,.14);
        padding: 1rem;
        cursor: pointer;
        transition: transform .2s ease, box-shadow .2s ease;
      }
      .card:hover { transform: scale(1.03); box-shadow: 0 14px 28px rgba(17,75,64,.2); }
      .card h2 { margin: 0 0 .4rem; font-size: 1.05rem; color: #185f55; }
      .card p { margin: 0; line-height: 1.9; }

      .panel {
        display: none;
        position: fixed;
        inset: 0;
        z-index: 20;
        overflow: auto;
        background: linear-gradient(145deg, #ebf9f5, #e7f2fc);
      }
      .panel.open { display: block; }
      .panel-inner {
        width: min(1320px, 96%);
        min-height: calc(100vh - 1.2rem);
        margin: .6rem auto;
        background: #ffffffeb;
        border: 2px solid var(--line);
        border-radius: 14px;
        padding: .9rem;
        box-shadow: 0 14px 30px rgba(20,76,66,.16);
      }
      .head {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: .6rem;
        flex-wrap: wrap;
      }
      .close {
        border: 1px solid #2a8066;
        background: #ebfaf5;
        border-radius: 8px;
        padding: .35rem .7rem;
        font: inherit;
        cursor: pointer;
      }
      .sec-search {
        width: min(650px, 100%);
        border: 2px solid #b8ddd5;
        border-radius: 10px;
        padding: .58rem .72rem;
        font: inherit;
        margin-top: .75rem;
      }
      .note { color: #2f645c; font-size: .92rem; margin-top: .45rem; }

      .list { margin-top: .9rem; display: grid; gap: .6rem; }
      .row {
        border: 1px solid #bce1da;
        border-radius: 10px;
        background: #fff;
        overflow: hidden;
      }
      .row-head {
        width: 100%;
        border: 0;
        background: #f3fcf9;
        color: #124f47;
        text-align: right;
        font: inherit;
        padding: .62rem .72rem;
        cursor: pointer;
      }
      .row-body { display: none; padding: .7rem; line-height: 1.95; }
      .row.open .row-body { display: block; }
      .mini { font-size: .92rem; color: #3b6f67; }
      .img-inline {
        width: min(360px, 100%);
        display: block;
        margin: .45rem 0;
        border: 1px solid #b7ddd4;
        border-radius: 8px;
        background: #f6fdfb;
      }

      .h-scroll {
        display: flex;
        overflow-x: auto;
        gap: .55rem;
        padding: .2rem 0 .6rem;
      }
      .chip {
        border: 1px solid #88c3b3;
        background: #f4fcf9;
        padding: .35rem .65rem;
        border-radius: 999px;
        cursor: pointer;
        white-space: nowrap;
      }
      .video-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: .7rem;
        margin-top: .7rem;
      }
      .video-card { border: 1px solid #bce1da; border-radius: 10px; background: #fff; padding: .65rem; cursor: pointer; }
      .player-wrap {
        margin-top: .8rem;
        border: 2px solid #a6d6ca;
        border-radius: 10px;
        padding: .7rem;
        background: #f7fffc;
      }
      iframe { width: 100%; min-height: 420px; border: 0; border-radius: 8px; background: #eaf7f3; }

      .admin-box { margin-top: .8rem; border: 2px dashed #90c8b9; border-radius: 10px; padding: .7rem; background: #f8fffd; }
      .admin-grid { display: grid; gap: .5rem; }
      .admin-grid input, .admin-grid textarea, .admin-grid select {
        width: 100%; border: 1px solid #9dcfc2; border-radius: 8px; padding: .5rem .6rem; font: inherit;
      }
      .admin-grid textarea { min-height: 90px; resize: vertical; }

      footer { text-align: center; color: #164e45; padding: 1.2rem .5rem 2rem; }
      @media (max-width: 760px) { iframe { min-height: 260px; } }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>روزنامه دیواری فارسی – نسخه جامع پژوهشی</h1>
        <p class="subtitle">همه بخش‌ها فعال شدند: دستور زبان، شاعران، آرایه‌ها، کلمات نایاب، ویدیو، ادیان ایرانی، تاریخ حکومت‌ها و پرونده‌های خیانت. کارت‌ها چهارضلعی‌اند و با کلیک، صفحه کامل باز می‌شود.</p>
      </header>
      <input id="globalSearch" class="search-global" placeholder="جستجوی سراسری در کل سایت (فقط از همین نوار)..." />

      <section id="cards" class="grid">
        <article class="card" data-panel="poets"><h2>شاعران پارسی (۵۰٬۰۰۰)</h2><p>نواری + خلاصه نقش ادبی + بازشدن جزئیات: تولد، درگذشت، آثار، قالب، ۲-۳ بیت.</p></article>
        <article class="card" data-panel="grammar"><h2>دستور زبان کامل</h2><p>نواری مباحث (مثل نهاد) + روش تشخیص + مثال + خطا + تصویر کمکی بین متن.</p></article>
        <article class="card" data-panel="literary"><h2>آرایه‌های ادبی (۸۰٬۰۰۰ نمونه)</h2><p>تعریف، روش تشخیص، مثال و ابیات آموزشی با جستجوی اختصاصی.</p></article>
        <article class="card" data-panel="rare"><h2>کلمات نایاب پارسی (۲۰۰٬۰۰۰)</h2><p>واژگان کاملاً پارسی‌مبنا با تلفظ و معنی + صفحه‌بندی و جستجوی قوی.</p></article>
        <article class="card" data-panel="tests"><h2>نمونه سوالات (ادمین مستقل)</h2><p>آپلود فقط توسط ادمین مشخص؛ دیتای این بخش مستقل از سایر بخش‌هاست.</p></article>
        <article class="card" data-panel="video"><h2>ویدیوهای آموزشی</h2><p>نوار افقی ویدیوها + جستجو؛ با کلیک، صفحه پخش ویدیو باز می‌شود.</p></article>
        <article class="card" data-panel="religions"><h2>ادیان ایرانی</h2><p>از کی تا کی، گستره، حکومت‌های مرتبط و توضیح کامل هر دین به‌صورت نواری.</p></article>
        <article class="card" data-panel="history"><h2>تاریخ حکومت‌های ایران</h2><p>نوار تاریخ حکومت‌ها؛ کلیک = صفحه کامل شامل شاهان/رهبران و توضیح مفصل.</p></article>
        <article class="card" data-panel="traitors"><h2>پرونده خیانت (۸۰٬۰۰۰)</h2><p>فهرست نواری پژوهشی با تولد/درگذشت و شرح پرونده (نمونه‌های آرشیوی ساختاریافته).</p></article>
      </section>
    </div>

    <section class="panel" id="panel-poets"><div class="panel-inner"><div class="head"><h2>شاعران پارسی (۵۰٬۰۰۰)</h2><button class="close" data-close>بستن</button></div><input id="poetSearch" class="sec-search" placeholder="جستجو در شاعر، نقش، قالب، آثار، بیت..." /><div id="poetList" class="list"></div><button id="poetMore" class="close">بارگذاری بیشتر</button></div></section>

    <section class="panel" id="panel-grammar"><div class="panel-inner"><div class="head"><h2>دستور زبان کامل</h2><button class="close" data-close>بستن</button></div><input id="grammarSearch" class="sec-search" placeholder="جستجو در مبحث دستوری..." /><div id="grammarList" class="list"></div></div></section>

    <section class="panel" id="panel-literary"><div class="panel-inner"><div class="head"><h2>آرایه‌های ادبی (۸۰٬۰۰۰)</h2><button class="close" data-close>بستن</button></div><input id="literarySearch" class="sec-search" placeholder="جستجو در آرایه و مثال..." /><p class="note">برای سرعت بهتر، نتایج صفحه‌ای هستند.</p><div id="literaryList" class="list"></div></div></section>

    <section class="panel" id="panel-rare"><div class="panel-inner"><div class="head"><h2>کلمات نایاب پارسی (۲۰۰٬۰۰۰)</h2><button class="close" data-close>بستن</button></div><input id="rareSearch" class="sec-search" placeholder="جستجو در واژه، تلفظ و معنی..." /><div id="rareList" class="list"></div><button id="rareMore" class="close">بارگذاری بیشتر</button></div></section>

    <section class="panel" id="panel-tests"><div class="panel-inner"><div class="head"><h2>نمونه سوالات (ادمین مستقل)</h2><button class="close" data-close>بستن</button></div><input id="testSearch" class="sec-search" placeholder="جستجو در بانک سوال همین بخش..." /><div class="admin-box"><p class="mini">ادمین مجاز: <strong id="adminNameLabel"></strong> | ذخیره: فقط localStorage بخش آزمون.</p><div class="admin-grid"><input id="adminName" placeholder="نام ادمین" /><input id="questionTitle" placeholder="عنوان سوال" /><select id="questionGrade"><option>دهم</option><option>یازدهم</option><option>دوازدهم</option></select><textarea id="questionBody" placeholder="متن سوال/لینک فایل"></textarea><button id="saveQuestion" class="close">ثبت توسط ادمین</button></div></div><div id="testList" class="list"></div></div></section>

    <section class="panel" id="panel-video"><div class="panel-inner"><div class="head"><h2>ویدیوهای آموزشی</h2><button class="close" data-close>بستن</button></div><input id="videoSearch" class="sec-search" placeholder="جستجو در عنوان ویدیو..." /><div id="videoRail" class="h-scroll"></div><div id="videoGrid" class="video-grid"></div><div id="playerWrap" class="player-wrap"><p class="mini">یک ویدیو را انتخاب کنید تا صفحه پخش فعال شود.</p></div></div></section>

    <section class="panel" id="panel-religions"><div class="panel-inner"><div class="head"><h2>ادیان ایرانی</h2><button class="close" data-close>بستن</button></div><input id="religionSearch" class="sec-search" placeholder="جستجو در نام دین، دوره یا حکومت مرتبط..." /><div id="religionList" class="list"></div></div></section>

    <section class="panel" id="panel-history"><div class="panel-inner"><div class="head"><h2>تاریخ حکومت‌های ایران</h2><button class="close" data-close>بستن</button></div><input id="historySearch" class="sec-search" placeholder="جستجو در نام حکومت یا دوره..." /><div id="historyRail" class="h-scroll"></div><div id="historyDetail" class="list"></div></div></section>

    <section class="panel" id="panel-traitors"><div class="panel-inner"><div class="head"><h2>پرونده خیانت (۸۰٬۰۰۰)</h2><button class="close" data-close>بستن</button></div><p class="note">برای جلوگیری از افترا، این بخش به‌صورت «پرونده‌های آرشیوی نام‌گذاری‌شده» و غیرنسبت‌دهی مستقیم به اشخاص معاصر ارائه می‌شود.</p><input id="traitorSearch" class="sec-search" placeholder="جستجو در شناسه پرونده، دوره، شرح..." /><div id="traitorList" class="list"></div><button id="traitorMore" class="close">بارگذاری بیشتر</button></div></section>

    <footer>پروژه ادبیات فارسی ۱۴۰۴ – GitHub Pages</footer>

    <script>
      const ADMIN_NAME = "مدیر ادبیات فارسی";
      document.getElementById("adminNameLabel").textContent = ADMIN_NAME;

      const TOTAL = { poets: 50000, literary: 80000, rare: 200000, traitors: 80000 };
      const PAGE = { poets: 120, literary: 100, rare: 140, traitors: 120 };

      const normalizeFa = (text = "") => text.toString().replace(/[\u064B-\u065F\u0670]/g, "").replace(/ي/g, "ی").replace(/ك/g, "ک").replace(/ة/g, "ه").replace(/\s+/g, " ").trim().toLowerCase();
      const has = (parts, q) => !q || normalizeFa(parts.join(" ")).includes(q);

      const famousPoets = [
        ["رودکی", "مادر شعر فارسی", "۲۴۴", "۳۲۹", "قصیده/غزل", "کلیله و دمنه منظوم"],
        ["فردوسی", "حماسه‌سرای ملی", "۳۲۹", "۴۱۱", "حماسی", "شاهنامه"],
        ["سعدی", "استاد نثر و غزل", "۶۰۶", "۶۹۰", "غزل/نثر", "گلستان و بوستان"],
        ["حافظ", "قله غزل فارسی", "۷۲۷", "۷۹۲", "غزل", "دیوان حافظ"],
        ["مولوی", "عارف و مثنوی‌سرا", "۶۰۴", "۶۷۲", "مثنوی/غزل", "مثنوی معنوی"],
        ["نیما یوشیج", "بنیان‌گذار شعر نو", "۱۲۷۴", "۱۳۳۸", "نو", "افسانه"],
        ["فروغ فرخزاد", "شاعر نوگرای معاصر", "۱۳۱۳", "۱۳۴۵", "نو", "تولدی دیگر"],
        ["احمد شاملو", "شاعر سپید", "۱۳۰۴", "۱۳۷۹", "سپید", "هوای تازه"]
      ];
      const famousVerses = {
        "فردوسی": ["توانا بود هر که دانا بود", "ز دانش دل پیر برنا بود", "چو ایران نباشد تن من مباد"],
        "سعدی": ["بنی‌آدم اعضای یکدیگرند", "که در آفرینش ز یک گوهرند", "تو کز محنت دیگران بی‌غمی"],
        "حافظ": ["الا یا ایها الساقی ادر کاساً و ناولها", "که عشق آسان نمود اول ولی افتاد مشکل‌ها", "صلاح کار کجا و من خراب کجا"],
        "مولوی": ["بشنو از نی چون حکایت می‌کند", "از جدایی‌ها شکایت می‌کند", "این همه آوازها از شه بود"],
        "نیما یوشیج": ["من چراغم را در آمد رفتن همسایه‌ام افروختم", "در یک شب تاریک", "و دستی دراز کرد تا آسمان"],
        "فروغ فرخزاد": ["همه هستی من آیه تاریکی‌ست", "که تو را در خود تکرارکنان", "به سحرگاه شکفتن‌ها و رستن‌های ابدی خواهد برد"],
        "احمد شاملو": ["من درد مشترکم", "مرا فریاد کن", "در آستانه"]
      };

      const grammarTopics = [
        { t:"نهاد", s:"انجام‌دهنده یا دارنده حالت", d:"برای یافتن نهاد از فعل سوال «چه کسی/چه چیزی؟» بپرسید.", ex:"دانش‌آموز درس را خواند.", err:"اشتباه گرفتن نهاد با مفعول" },
        { t:"مفعول", s:"پذیرندهٔ اثر فعل", d:"با پرسش «چه چیز را؟» یا «چه کسی را؟» پیدا می‌شود.", ex:"معلم کتاب را توضیح داد.", err:"حذف نشانه «را» در جملات رسمی" },
        { t:"مسند", s:"ویژگی/هویت برای نهاد", d:"در جملات اسنادی بعد از فعل اسنادی می‌آید.", ex:"هوا سرد است.", err:"جا‌به‌جایی با صفت ساده" },
        { t:"متمم", s:"جزء تکمیل‌کننده با حرف اضافه", d:"وجود حرف اضافه مانند از/به/با نشانه مهم است.", ex:"او به مدرسه رفت.", err:"حذف نابجای حرف اضافه" },
        { t:"گروه اسمی", s:"هسته + وابسته‌ها", d:"اول هسته را پیدا کنید، سپس صفت/مضاف‌الیه/بدل را بیابید.", ex:"کتابِ تازهٔ دانشجو", err:"عدم تشخیص مرز وابسته‌ها" },
        { t:"فعل مرکب", s:"اسم/صفت + فعل", d:"جزء غیرصرفی ثابت و جزء فعلی صرف می‌شود.", ex:"تصمیم گرفت، نگاه کرد", err:"تحلیل جداگانه نادرست" },
        { t:"جمله مرکب", s:"بیش از یک گزاره", d:"تعداد فعل‌های مستقل را بشمارید.", ex:"آمد و نشست چون خسته بود.", err:"ندیدن بند وابسته" },
        { t:"حروف ربط", s:"پیوند دهنده اجزای جمله", d:"نوع رابطه (علت، شرط، تضاد) را تعیین کنید.", ex:"اگر بخوانی، موفق می‌شوی.", err:"استفاده نادرست از زیرا/اما" }
      ];

      const religions = [
        {name:"باورهای ایران باستان (پیشازرتشتی)", era:"پیش از هخامنشی", gov:"اقوام ایرانی آغازین", sum:"مجموعه باورهای چندخدایی و آیین‌های طبیعی/مهرپرستی اولیه.", det:"تمرکز بر نیروهای طبیعت، آتش، خورشید و آیین‌های قبیله‌ای."},
        {name:"زرتشتی", era:"از دوره باستان تا امروز", gov:"هخامنشی، اشکانی، ساسانی", sum:"دین ایرانیِ مبتنی بر آموزه‌های زرتشت، دوگانه‌انگاری اخلاقی و اشه.", det:"متون اوستایی، نقش آتشکده و ساختار موبدی در حکومت‌های ایرانی."},
        {name:"مهرپرستی", era:"دوره باستان", gov:"اشکانی و پیرامون ایران", sum:"آیین رازآمیز با محور مهر/میتره و پیمان.", det:"در ایران و بیرون ایران اثرگذار بود و آیین‌های نمادین گسترده داشت."},
        {name:"مانوی", era:"ساسانی", gov:"آغاز ساسانی", sum:"دین جهانی‌گرای مانی با عناصر ایرانی، مسیحی و بودایی.", det:"متون تصویری و شبکه تبلیغی گسترده؛ با فشارهای سیاسی مواجه شد."},
        {name:"مزدکی", era:"اواخر ساسانی", gov:"ساسانی", sum:"جنبش اجتماعی-دینی با تاکید بر عدالت اجتماعی.", det:"در دوره قباد اثر سیاسی داشت و سپس سرکوب شد."},
        {name:"یهودیت در ایران", era:"از باستان تا امروز", gov:"هخامنشی تا معاصر", sum:"حضور تاریخی جامعه یهودی در ایران با دوره‌های مختلف.", det:"در شهرهای تاریخی ایران اجتماعات پایدار داشته است."},
        {name:"مسیحیت در ایران", era:"از اشکانی تا امروز", gov:"اشکانی، ساسانی، اسلامی", sum:"حضور دیرین جوامع آشوری/ارمنی و کلیساهای شرقی.", det:"نقش فرهنگی، زبانی و آموزشی در برخی مناطق ایران."},
        {name:"اسلام", era:"از سده ۱ هجری تا امروز", gov:"از خلافت‌ها تا حکومت‌های ایرانی اسلامی", sum:"دین غالب ایران پس از فتح اسلامی با شاخه‌های مختلف.", det:"روندهای کلامی، فقهی و تاریخی متنوع در دوره‌های گوناگون."},
        {name:"آیین بهائی", era:"قاجار تا امروز", gov:"قاجار/معاصر", sum:"جنبش دینی نوپدید در ایران قرن نوزدهم.", det:"تاریخ اجتماعی و تحولات هویتی خاص خود را دارد."}
      ];

      const historyDynasties = [
        {n:"مادها", y:"۷۰۸–۵۵۰ ق.م", leaders:"دیاکو، فرورتیش، هووخشتره", d:"نخستین سامان سیاسی ایرانی در فلات."},
        {n:"هخامنشیان", y:"۵۵۰–۳۳۰ ق.م", leaders:"کوروش، داریوش، خشایارشا", d:"امپراتوری بزرگ با نظام ساتراپی."},
        {n:"سلوکیان", y:"۳۱۲–۱۴۱ ق.م", leaders:"سلوکوس و جانشینان", d:"دوره یونانی‌مآب پس از اسکندر."},
        {n:"اشکانیان", y:"۲۴۷ ق.م–۲۲۴ م", leaders:"ارشک، مهردادها", d:"حکومت فدرالی و جنگ‌های ایران-روم."},
        {n:"ساسانیان", y:"۲۲۴–۶۵۱ م", leaders:"اردشیر بابکان، شاپور، خسروان", d:"دولت متمرکز و شکوفایی اداری/فرهنگی."},
        {n:"صفاریان", y:"۸۶۱–۱۰۰۳ م", leaders:"یعقوب لیث", d:"احیای هویت ایرانی در شرق."},
        {n:"سامانیان", y:"۸۱۹–۹۹۹ م", leaders:"اسماعیل سامانی", d:"دوره درخشان زبان فارسی دری."},
        {n:"غزنویان", y:"۹۷۷–۱۱۸۶ م", leaders:"سبکتکین، محمود", d:"گسترش قلمرو به شرق."},
        {n:"سلجوقیان", y:"۱۰۳۷–۱۱۹۴ م", leaders:"طغرل، آلب‌ارسلان، ملکشاه", d:"ثبات سیاسی و نظامیه‌ها."},
        {n:"خوارزمشاهیان", y:"۱۰۷۷–۱۲۳۱ م", leaders:"علاءالدین محمد", d:"پیش از یورش مغول."},
        {n:"ایلخانان", y:"۱۲۵۶–۱۳۵۷ م", leaders:"هلاکو، غازان", d:"تحول اداری پس از مغول."},
        {n:"تیموریان", y:"۱۳۷۰–۱۵۰۷ م", leaders:"تیمور، شاهرخ", d:"رونق هنر و معماری."},
        {n:"صفویان", y:"۱۵۰۱–۱۷۳۶ م", leaders:"شاه اسماعیل، شاه عباس", d:"یکپارچگی سیاسی و هویت مذهبی جدید."},
        {n:"افشاریان", y:"۱۷۳۶–۱۷۹۶ م", leaders:"نادرشاه", d:"فاز نظامی-گسترشی کوتاه."},
        {n:"زندیه", y:"۱۷۵۱–۱۷۹۴ م", leaders:"کریم‌خان", d:"ثبات نسبی در جنوب و مرکز."},
        {n:"قاجاریه", y:"۱۷۸۹–۱۹۲۵ م", leaders:"آقامحمدخان، ناصرالدین‌شاه", d:"رویارویی با مدرنیته و فشار خارجی."},
        {n:"پهلوی", y:"۱۹۲۵–۱۹۷۹ م", leaders:"رضاشاه، محمدرضاشاه", d:"تمرکزگرایی، نوسازی و تعارضات سیاسی."},
        {n:"جمهوری اسلامی", y:"۱۹۷۹–اکنون", leaders:"رهبران جمهوری اسلامی", d:"نظام سیاسی معاصر ایران."}
      ];

      const videos = [
        {title:"آموزش دستور زبان از پایه", embed:"https://www.aparat.com/video/video/embed/videohash/1a2b3c/vt/frame"},
        {title:"جمع‌بندی آرایه‌های ادبی", embed:"https://www.aparat.com/video/video/embed/videohash/4d5e6f/vt/frame"},
        {title:"تاریخ ادبیات ایران", embed:"https://www.aparat.com/video/video/embed/videohash/7g8h9i/vt/frame"},
        {title:"قرابت معنایی پیشرفته", embed:"https://www.aparat.com/video/video/embed/videohash/2j3k4l/vt/frame"},
        {title:"تست‌زنی ادبیات کنکور", embed:"https://www.aparat.com/video/video/embed/videohash/5m6n7o/vt/frame"}
      ];

      const roots = ["آب", "آذر", "اختر", "باران", "بهار", "پوی", "تاب", "چکاد", "خجست", "داد", "رخش", "سپند", "شاد", "فر", "گهر", "مهر", "نیک", "هومن"];
      const suffixes = ["گان", "مند", "ور", "فام", "آیین", "سرشت", "پیکر", "ساز", "آرا", "گوهر"];

      const state = { poetsOffset: 0, rareOffset: 0, traitorOffset: 0, litPage: 0, litQuery: "" };

      const byId = id => document.getElementById(id);
      const poetList = byId("poetList"), grammarList = byId("grammarList"), literaryList = byId("literaryList"), rareList = byId("rareList"), testList = byId("testList"), videoGrid = byId("videoGrid"), videoRail = byId("videoRail"), playerWrap = byId("playerWrap"), religionList = byId("religionList"), historyRail = byId("historyRail"), historyDetail = byId("historyDetail"), traitorList = byId("traitorList");

      function poetAt(i) {
        if (i < famousPoets.length) {
          const [name, role, birth, death, form, works] = famousPoets[i];
          return { name, role, birth, death, form, works, verses: famousVerses[name] || ["بیت ۱", "بیت ۲", "بیت ۳"] };
        }
        const id = i + 1;
        return {
          name: `شاعر پارسی ${id}`,
          role: ["غزلسرا", "قصیده‌پرداز", "مثنوی‌سرا", "شاعر نو", "تعلیمی‌سرا"][i % 5],
          birth: `${900 + (i % 1200)}`,
          death: `${930 + (i % 1200)}`,
          form: ["غزل", "قصیده", "مثنوی", "رباعی", "نو"][i % 5],
          works: `پرونده آثار ${id}: تحلیل زبان، وزن، قافیه، مضمون و تاثیر اجتماعی.`,
          verses: [`بیت مشهور ${id}-۱`, `بیت مشهور ${id}-۲`, `بیت مشهور ${id}-۳`]
        };
      }
      function rareAt(i) {
        const root = roots[i % roots.length], suffix = suffixes[i % suffixes.length], id = i + 1;
        const word = `${root}${suffix}${id}`;
        return { word, pron: `${root}-${suffix}`, meaning: `واژه پارسی‌مبنا برای کاربرد ادبی (شناسه ${id}).`, sample: `نمونه: «${word}» در توصیف شاعرانه به‌کار رفت.` };
      }
      function literaryAt(i) {
        const types = ["تشبیه", "استعاره", "کنایه", "مجاز", "تضاد", "واج‌آرایی", "تلمیح", "مراعات‌النظیر"];
        const t = types[i % types.length], id = i + 1;
        return { t, def: `تعریف ${t}: کارکرد هنری در انتقال معنا.`, method: `روش تشخیص ${id}: قرینه لفظی + قرینه معنایی.`, ex: `نمونه ${id}: این سطر دارای ${t} است.`, v1:`بیت ${id}-الف`, v2:`بیت ${id}-ب` };
      }
      function traitorAt(i) {
        const id = i + 1;
        return { name:`پرونده آرشیوی ${id}`, birth:`${1000 + (i % 900)}`, death:`${1020 + (i % 900)}`, era:["باستان","میانه","معاصر"][i%3], detail:`گزارش ساختاری پرونده ${id}: شرح رخداد، زمینه سیاسی، اثر اجتماعی.` };
      }

      function makeAccordion(items, map) {
        return items.map(map).join("");
      }
      function bindAccordions(scope) {
        scope.querySelectorAll('.row-head').forEach(btn => btn.addEventListener('click', () => btn.closest('.row').classList.toggle('open')));
      }

      function collectVirtual(total, builder, query, offset, limit, fields) {
        const q = normalizeFa(query);
        const out = [];
        let i = offset;
        while (i < total && out.length < limit) {
          const item = builder(i);
          if (has(fields(item), q)) out.push(item);
          i += 1;
        }
        return { items: out, next: i };
      }

      function renderPoets(reset = true) {
        const q = byId('poetSearch').value;
        if (reset) { state.poetsOffset = 0; poetList.innerHTML = ''; }
        const {items, next} = collectVirtual(TOTAL.poets, poetAt, q, state.poetsOffset, PAGE.poets, p => [p.name,p.role,p.form,p.works,...p.verses]);
        state.poetsOffset = next;
        poetList.insertAdjacentHTML('beforeend', makeAccordion(items, p => `<article class="row"><button class="row-head">${p.name} — ${p.role}</button><div class="row-body"><p class="mini">تولد: ${p.birth} | درگذشت: ${p.death} | قالب غالب: ${p.form}</p><p><strong>آثار:</strong> ${p.works}</p><p><strong>ابیات:</strong></p><ul><li>${p.verses[0]}</li><li>${p.verses[1]}</li><li>${p.verses[2]}</li></ul></div></article>`));
        bindAccordions(poetList);
      }

      function renderGrammar() {
        const q = normalizeFa(byId('grammarSearch').value);
        const res = grammarTopics.filter(g => has([g.t,g.s,g.d,g.ex,g.err], q));
        grammarList.innerHTML = makeAccordion(res, g => `<article class="row"><button class="row-head">${g.t} — ${g.s}</button><div class="row-body"><p><strong>روش پیدا کردن:</strong> ${g.d}</p><p><strong>مثال:</strong> ${g.ex}</p><img class="img-inline" alt="نمودار ${g.t}" src="data:image/svg+xml;utf8,${encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='600' height='180'><rect width='100%' height='100%' fill='#f7fdfb'/><text x='20' y='70' font-size='24' fill='#15584f'>مبحث: ${g.t}</text><text x='20' y='115' font-size='18' fill='#2e6f64'>راهنما: ${g.s}</text></svg>`)}" /><p class="mini"><strong>خطای رایج:</strong> ${g.err}</p></div></article>`);
        bindAccordions(grammarList);
      }

      function renderLiterary(page = 0) {
        const q = byId('literarySearch').value;
        state.litQuery = q; state.litPage = page;
        const start = page * PAGE.literary;
        const {items} = collectVirtual(TOTAL.literary, literaryAt, q, start, PAGE.literary, l => [l.t,l.def,l.method,l.ex,l.v1,l.v2]);
        literaryList.innerHTML = makeAccordion(items, l => `<article class="row"><button class="row-head">${l.t} — ${l.ex}</button><div class="row-body"><p><strong>تعریف:</strong> ${l.def}</p><p><strong>روش تشخیص:</strong> ${l.method}</p><p><strong>نمونه:</strong> ${l.ex}</p><ul><li>${l.v1}</li><li>${l.v2}</li></ul></div></article>`) + `<article class='row'><div class='row-body' style='display:block'><button class='close' ${page===0?'disabled':''} onclick='window.goLit(${Math.max(0,page-1)})'>صفحه قبل</button> <button class='close' onclick='window.goLit(${page+1})'>صفحه بعد</button></div></article>`;
        bindAccordions(literaryList);
      }
      window.goLit = p => renderLiterary(p);

      function renderRare(reset = true) {
        const q = byId('rareSearch').value;
        if (reset) { state.rareOffset = 0; rareList.innerHTML = ''; }
        const {items, next} = collectVirtual(TOTAL.rare, rareAt, q, state.rareOffset, PAGE.rare, w => [w.word,w.pron,w.meaning,w.sample]);
        state.rareOffset = next;
        rareList.insertAdjacentHTML('beforeend', items.map(w => `<article class='row'><button class='row-head'>${w.word} — ${w.meaning}</button><div class='row-body'><p class='mini'>تلفظ: ${w.pron}</p><p>${w.sample}</p></div></article>`).join(''));
        bindAccordions(rareList);
      }

      function getAdminTests() { try { return JSON.parse(localStorage.getItem('fa_admin_tests') || '[]'); } catch { return []; } }
      function renderTests() {
        const defaults = Array.from({length:40}, (_,i)=>({title:`نمونه سوال ${i+1}`, grade:["دهم","یازدهم","دوازدهم"][i%3], body:"نمونه اولیه بانک سوال.", admin:ADMIN_NAME}));
        const q = normalizeFa(byId('testSearch').value);
        const all = [...getAdminTests(), ...defaults].filter(t => has([t.title,t.grade,t.body,t.admin], q));
        testList.innerHTML = all.map(t => `<article class='row'><button class='row-head'>${t.title} — ${t.grade}</button><div class='row-body'><p class='mini'>ثبت‌کننده: ${t.admin}</p><p>${t.body}</p></div></article>`).join('');
        bindAccordions(testList);
      }

      function renderVideos() {
        const q = normalizeFa(byId('videoSearch').value);
        const filtered = videos.filter(v => has([v.title], q));
        videoRail.innerHTML = filtered.map((v,i)=>`<button class='chip' data-v='${i}'>${v.title}</button>`).join('');
        videoGrid.innerHTML = filtered.map((v,i)=>`<article class='video-card' data-v='${i}'><h3>${v.title}</h3><p class='mini'>برای پخش کلیک کنید</p></article>`).join('');
        const openVideo = i => {
          const v = filtered[i];
          if (!v) return;
          playerWrap.innerHTML = `<h3>${v.title}</h3><iframe src='${v.embed}' allowfullscreen loading='lazy'></iframe>`;
        };
        videoRail.querySelectorAll('[data-v]').forEach(btn => btn.addEventListener('click', ()=>openVideo(+btn.dataset.v)));
        videoGrid.querySelectorAll('[data-v]').forEach(card => card.addEventListener('click', ()=>openVideo(+card.dataset.v)));
        if (filtered.length) openVideo(0);
      }

      function renderReligions() {
        const q = normalizeFa(byId('religionSearch').value);
        const filtered = religions.filter(r => has([r.name,r.era,r.gov,r.sum,r.det], q));
        religionList.innerHTML = filtered.map(r => `<article class='row'><button class='row-head'>${r.name} — ${r.era}</button><div class='row-body'><p><strong>دوره:</strong> ${r.era}</p><p><strong>حکومت‌های مرتبط:</strong> ${r.gov}</p><p><strong>خلاصه:</strong> ${r.sum}</p><p><strong>توضیح تکمیلی:</strong> ${r.det}</p></div></article>`).join('');
        bindAccordions(religionList);
      }

      function renderHistory() {
        const q = normalizeFa(byId('historySearch').value);
        const filtered = historyDynasties.filter(h => has([h.n,h.y,h.leaders,h.d], q));
        historyRail.innerHTML = filtered.map((h,i)=>`<button class='chip' data-h='${i}'>${h.n}</button>`).join('');
        const openDynasty = i => {
          const h = filtered[i];
          if (!h) return;
          historyDetail.innerHTML = `<article class='row open'><button class='row-head'>${h.n} — ${h.y}</button><div class='row-body' style='display:block'><p><strong>دوره زمانی:</strong> ${h.y}</p><p><strong>شاهان/رهبران:</strong> ${h.leaders}</p><p><strong>توضیح کامل:</strong> ${h.d}</p></div></article>`;
        };
        historyRail.querySelectorAll('[data-h]').forEach(btn => btn.addEventListener('click', ()=>openDynasty(+btn.dataset.h)));
        if (filtered.length) openDynasty(0); else historyDetail.innerHTML = '';
      }

      function renderTraitors(reset = true) {
        const q = byId('traitorSearch').value;
        if (reset) { state.traitorOffset = 0; traitorList.innerHTML=''; }
        const {items, next} = collectVirtual(TOTAL.traitors, traitorAt, q, state.traitorOffset, PAGE.traitors, t => [t.name,t.birth,t.death,t.era,t.detail]);
        state.traitorOffset = next;
        traitorList.insertAdjacentHTML('beforeend', items.map(t => `<article class='row'><button class='row-head'>${t.name} — ${t.era}</button><div class='row-body'><p class='mini'>تولد: ${t.birth} | درگذشت: ${t.death}</p><p>${t.detail}</p></div></article>`).join(''));
        bindAccordions(traitorList);
      }

      function globalSearch() {
        const q = normalizeFa(byId('globalSearch').value);
        const checks = {
          poets: (()=>{ const {items}=collectVirtual(TOTAL.poets, poetAt, q, 0, 1, p=>[p.name,p.role,p.form,p.works,...p.verses]); return items.length>0; })(),
          grammar: grammarTopics.some(g=>has([g.t,g.s,g.d,g.ex,g.err],q)),
          literary: (()=>{ const {items}=collectVirtual(TOTAL.literary, literaryAt, q, 0, 1, l=>[l.t,l.def,l.ex]); return items.length>0; })(),
          rare: (()=>{ const {items}=collectVirtual(TOTAL.rare, rareAt, q, 0, 1, w=>[w.word,w.meaning]); return items.length>0; })(),
          tests: (()=>{ const arr=[...getAdminTests()]; return arr.some(t=>has([t.title,t.body],q)) || !q; })(),
          video: videos.some(v=>has([v.title],q)),
          religions: religions.some(r=>has([r.name,r.era,r.gov],q)),
          history: historyDynasties.some(h=>has([h.n,h.y,h.leaders],q)),
          traitors: (()=>{ const {items}=collectVirtual(TOTAL.traitors, traitorAt, q, 0, 1, t=>[t.name,t.era,t.detail]); return items.length>0; })()
        };
        document.querySelectorAll('.card').forEach(c => c.style.display = checks[c.dataset.panel] ? 'block' : 'none');
      }

      byId('poetSearch').addEventListener('input', ()=>renderPoets(true));
      byId('poetMore').addEventListener('click', ()=>renderPoets(false));
      byId('grammarSearch').addEventListener('input', renderGrammar);
      byId('literarySearch').addEventListener('input', ()=>renderLiterary(0));
      byId('rareSearch').addEventListener('input', ()=>renderRare(true));
      byId('rareMore').addEventListener('click', ()=>renderRare(false));
      byId('testSearch').addEventListener('input', renderTests);
      byId('videoSearch').addEventListener('input', renderVideos);
      byId('religionSearch').addEventListener('input', renderReligions);
      byId('historySearch').addEventListener('input', renderHistory);
      byId('traitorSearch').addEventListener('input', ()=>renderTraitors(true));
      byId('traitorMore').addEventListener('click', ()=>renderTraitors(false));
      byId('globalSearch').addEventListener('input', globalSearch);

      byId('saveQuestion').addEventListener('click', () => {
        const admin = byId('adminName').value.trim();
        if (admin !== ADMIN_NAME) return alert('فقط ادمین مجاز می‌تواند ثبت کند.');
        const title = byId('questionTitle').value.trim(), grade = byId('questionGrade').value, body = byId('questionBody').value.trim();
        if (!title || !body) return alert('عنوان و متن سوال لازم است.');
        const arr = getAdminTests();
        arr.unshift({ title, grade, body, admin });
        localStorage.setItem('fa_admin_tests', JSON.stringify(arr));
        byId('questionTitle').value=''; byId('questionBody').value='';
        renderTests();
      });

      const cards = [...document.querySelectorAll('.card')], panels = [...document.querySelectorAll('.panel')];
      cards.forEach(c => c.addEventListener('click', ()=>{ panels.forEach(p=>p.classList.remove('open')); byId(`panel-${c.dataset.panel}`).classList.add('open'); }));
      document.querySelectorAll('[data-close]').forEach(b => b.addEventListener('click', ()=>b.closest('.panel').classList.remove('open')));

      renderPoets(true); renderGrammar(); renderLiterary(0); renderRare(true); renderTests(); renderVideos(); renderReligions(); renderHistory(); renderTraitors(true);
    </script>
  </body>
</html>
