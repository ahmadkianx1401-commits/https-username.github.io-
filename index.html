<!doctype html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>روزنامه دیواری فارسی – نسخه هشتم کامل</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700;800&display=swap" rel="stylesheet" />
    <style>
      :root{--a:#b8ffe8;--b:#bde4ff;--c:#fff8bf;--ink:#0f3f39;--line:#18a777;--card:#ffffffeb}
      *{box-sizing:border-box}html,body{margin:0;font-family:Vazirmatn,sans-serif;color:var(--ink);background:linear-gradient(135deg,var(--a),var(--b),var(--c))}
      .container{width:min(1360px,95%);margin:auto}.title{text-align:center;padding:1.6rem 0 .8rem}h1{margin:.2rem 0}.sub{max-width:1000px;margin:auto;line-height:2}
      .global{width:min(860px,100%);display:block;margin:1rem auto;border:2px solid #7bd2b5;border-radius:12px;padding:.7rem .9rem;font:inherit;background:#fff}
      .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem;padding-bottom:1.2rem}
      .card{background:var(--card);border:2px solid var(--line);border-radius:12px;padding:1rem;box-shadow:0 10px 24px rgba(0,0,0,.08);cursor:pointer;transition:.2s}.card:hover{transform:scale(1.03)}
      .panel{display:none;position:fixed;inset:0;z-index:20;background:linear-gradient(145deg,#eefff8,#eef7ff);overflow:auto}.panel.open{display:block}
      .inner{width:min(1360px,96%);margin:.7rem auto;min-height:calc(100vh - 1.4rem);background:#fffffff0;border:2px solid var(--line);border-radius:14px;padding:.8rem}
      .head{display:flex;justify-content:space-between;align-items:center;gap:.5rem;flex-wrap:wrap}.btn{border:1px solid #1f9270;background:#ebfff7;border-radius:8px;padding:.35rem .7rem;cursor:pointer;font:inherit}
      .sec{width:min(720px,100%);border:2px solid #9fdccd;border-radius:10px;padding:.55rem .7rem;margin-top:.7rem;font:inherit}
      .rail{display:flex;gap:.5rem;overflow:auto;padding:.4rem 0}.chip{white-space:nowrap;border:1px solid #82cdb7;background:#f5fffb;border-radius:999px;padding:.3rem .65rem;cursor:pointer}
      .list{display:grid;gap:.55rem;margin-top:.7rem}.row{border:1px solid #b7e3d8;border-radius:10px;background:#fff;overflow:hidden}.rowh{width:100%;text-align:right;border:0;background:#f4fffb;padding:.6rem .7rem;font:inherit;cursor:pointer}
      .rowb{display:none;padding:.65rem;line-height:1.95}.row.open .rowb{display:block}.mini{font-size:.9rem;color:#3a6e66}
      .vgrid{display:grid;grid-template-columns:repeat(auto-fit,minmax(230px,1fr));gap:.6rem}.vcard{border:1px solid #b7e3d8;border-radius:10px;background:#fff;padding:.6rem;cursor:pointer}
      iframe{width:100%;min-height:420px;border:0;border-radius:8px;background:#eaf7f3}.player{margin-top:.7rem;border:2px solid #9ad8c8;border-radius:10px;padding:.6rem;background:#f8fffc}
      table{border-collapse:collapse;width:100%;margin:.5rem 0}td,th{border:1px solid #bee5dc;padding:.35rem .45rem}th{background:#f2fffa}
      .adminform{display:grid;gap:.5rem;max-width:620px}.adminform input,.adminform select{border:1px solid #9fd3c4;border-radius:8px;padding:.45rem .55rem;font:inherit}
      footer{text-align:center;padding:1rem 0 2rem;color:#12554a}
      @media (max-width:760px){iframe{min-height:250px}}
    </style>
  </head>
  <body>
    <div class="container">
      <section class="title">
        <h1>روزنامه دیواری فارسی هشتم – نسخه کامل و شاداب</h1>
        <p class="sub">نسخه جدید با رنگ شاد، پنل‌های تمام‌صفحه، جستجوی سراسری، دستور زبان کامل، آرایه‌ها، شاعران، کلمات نایاب، ادیان، تاریخ، و بانک نمونه‌سوال فارسی هشتم.</p>
      </section>
      <input id="globalSearch" class="global" placeholder="جستجوی سراسری در کل سایت..." />
      <section id="cards" class="grid">
        <article class="card" data-panel="poets"><h2>شاعران پارسی (۵۰٬۰۰۰)</h2><p>زندگی‌نامه، دوره، آثار، ابیات معروف، تحلیل سبک.</p></article>
        <article class="card" data-panel="grammar"><h2>دستور زبان فارسی هشتم (۲۰۰ مدل)</h2><p>روش پیدا کردن + جدول مثال + توضیح کامل هر مبحث.</p></article>
        <article class="card" data-panel="literary"><h2>آرایه‌های ادبی</h2><p>تعریف، کاربرد، مثال، نمودار و نمونه‌های گسترده.</p></article>
        <article class="card" data-panel="rare"><h2>کلمات نایاب (۲۰۰٬۰۰۰)</h2><p>معنی کامل + مثال + دو خط کاربرد در متن.</p></article>
        <article class="card" data-panel="tests"><h2>نمونه سوالات فارسی هشتم</h2><p>فقط لیست نمونه سوال + دانلود PDF.</p></article>
        <article class="card" data-panel="video"><h2>ویدیوهای آموزشی</h2><p>جستجو + نوار افقی + پخش با کلیک.</p></article>
        <article class="card" data-panel="religions"><h2>ادیان در ایران</h2><p>دوره، حکومت، شیوه ارتباط با خدا/امر قدسی.</p></article>
        <article class="card" data-panel="history"><h2>تاریخ حکومت‌های ایران</h2><p>نوار تاریخی + شاهان/رهبران + نوع حکومت و معنی آن.</p></article>
        <article class="card" data-panel="traitors"><h2>پرونده خیانت (تاریخی)</h2><p>نام، چه کرد، چرا، سال؛ با مرتب‌سازی حرفه‌ای.</p></article>
        <article class="card" data-panel="admin"><h2>پنل ادمین</h2><p>ورود با نام‌کاربری/رمز و آپلود فایل سوال.</p></article>
      </section>
    </div>

    <section class="panel" id="panel-poets"><div class="inner"><div class="head"><h2>شاعران پارسی</h2><button class="btn" data-close>بستن</button></div><input id="poetSearch" class="sec" placeholder="جستجو در شاعر، سال، اثر، بیت..." /><div id="poetList" class="list"></div><button id="poetMore" class="btn">بارگذاری بیشتر</button></div></section>
    <section class="panel" id="panel-grammar"><div class="inner"><div class="head"><h2>دستور زبان فارسی هشتم (۲۰۰ مدل)</h2><button class="btn" data-close>بستن</button></div><input id="grammarSearch" class="sec" placeholder="جستجو در مبحث، تعریف، مثال..." /><div id="grammarList" class="list"></div></div></section>
    <section class="panel" id="panel-literary"><div class="inner"><div class="head"><h2>آرایه‌های ادبی</h2><button class="btn" data-close>بستن</button></div><input id="literarySearch" class="sec" placeholder="جستجو در آرایه و مثال..." /><div id="literaryList" class="list"></div></div></section>
    <section class="panel" id="panel-rare"><div class="inner"><div class="head"><h2>کلمات نایاب</h2><button class="btn" data-close>بستن</button></div><input id="rareSearch" class="sec" placeholder="جستجو در واژه و معنی..." /><div id="rareList" class="list"></div><button id="rareMore" class="btn">بارگذاری بیشتر</button></div></section>
    <section class="panel" id="panel-tests"><div class="inner"><div class="head"><h2>نمونه سوالات فارسی هشتم</h2><button class="btn" data-close>بستن</button></div><input id="testSearch" class="sec" placeholder="جستجو در عنوان سوال..." /><div id="testList" class="list"></div></div></section>
    <section class="panel" id="panel-video"><div class="inner"><div class="head"><h2>ویدیوهای آموزشی</h2><button class="btn" data-close>بستن</button></div><input id="videoSearch" class="sec" placeholder="جستجو در ویدیوها..." /><div id="videoRail" class="rail"></div><div id="videoGrid" class="vgrid"></div><div id="player" class="player"><p class="mini">یک ویدیو انتخاب کنید.</p></div></div></section>
    <section class="panel" id="panel-religions"><div class="inner"><div class="head"><h2>ادیان ایرانی</h2><button class="btn" data-close>بستن</button></div><input id="religionSearch" class="sec" placeholder="جستجو در دین، دوره، حکومت..." /><div id="religionList" class="list"></div></div></section>
    <section class="panel" id="panel-history"><div class="inner"><div class="head"><h2>تاریخ حکومت‌های ایران</h2><button class="btn" data-close>بستن</button></div><input id="historySearch" class="sec" placeholder="جستجو در حکومت..." /><div id="historyRail" class="rail"></div><div id="historyList" class="list"></div></div></section>
    <section class="panel" id="panel-traitors"><div class="inner"><div class="head"><h2>پرونده‌های خیانت تاریخی</h2><button class="btn" data-close>بستن</button></div><div class="head"><input id="traitorSearch" class="sec" style="margin:0" placeholder="جستجو در نام، علت، سال..." /><select id="traitorSort" class="sec" style="max-width:220px;margin:0"><option value="year">مرتب‌سازی: سال</option><option value="reason">مرتب‌سازی: علت/نوع</option></select><select id="traitorDir" class="sec" style="max-width:220px;margin:0"><option value="desc">از بالا به پایین (جدید به قدیم)</option><option value="asc">از پایین به بالا (قدیم به جدید)</option></select></div><div id="traitorList" class="list"></div></div></section>
    <section class="panel" id="panel-admin"><div class="inner"><div class="head"><h2>پنل ادمین (آپلود فایل)</h2><button class="btn" data-close>بستن</button></div><div class="adminform"><input id="adminUser" placeholder="نام کاربری" /><input id="adminPass" type="password" placeholder="رمز عبور" /><input id="uploadTitle" placeholder="عنوان نمونه سوال" /><input id="uploadFile" type="file" accept=".pdf" /><button id="uploadBtn" class="btn">ورود و آپلود</button><p class="mini">نام کاربری: <b>ahmadkian1390</b> | رمز: <b>ahmadkian1391</b></p></div></div></section>

    <footer>پروژه ادبیات فارسی ۱۴۰۴ – GitHub Pages</footer>

    <script>
      const TOTAL={poets:50000,rare:200000}; const PAGE={poets:100,rare:140};
      const USER='ahmadkian1390', PASS='ahmadkian1391';
      const norm=t=>(t||'').toString().replace(/[\u064B-\u065F\u0670]/g,'').replace(/ي/g,'ی').replace(/ك/g,'ک').replace(/\s+/g,' ').trim().toLowerCase();
      const has=(arr,q)=>!q||norm(arr.join(' ')).includes(q);
      const by=id=>document.getElementById(id);

      const basePoets=[
        {name:'حافظ',years:'۷۲۶–۷۹۲ ق',role:'غزل‌سرای بزرگ و لسان‌الغیب',bio:'خواجه شمس‌الدین محمد شیرازی، متخلص به حافظ، از بزرگ‌ترین غزل‌سرایان پارسی است. در شیراز بالید، علوم ادبی/فقهی آموخت، قرآن را با روایت‌های گوناگون از بر داشت و دیوانش الهام‌بخش ادبیات جهانی شد.',works:'دیوان حافظ (غزلیات، قصاید، مثنوی‌ها، قطعات، رباعیات)',verses:['الا یا ایها الساقی ادر کاساً و ناولها','صلاح کار کجا و من خراب کجا','دوش دیدم که ملایک در میخانه زدند']},
        {name:'فردوسی',years:'۳۲۹–۴۱۱ ق',role:'حماسه‌سرای ملی',bio:'ابوالقاسم فردوسی با شاهنامه زبان و هویت ایرانی را پایدار کرد و روایت اساطیری/تاریخی ایران را منظوم ساخت.',works:'شاهنامه',verses:['توانا بود هر که دانا بود','چو ایران نباشد تن من مباد','ز دانش دل پیر برنا بود']},
        {name:'سعدی',years:'۶۰۶–۶۹۰ ق',role:'استاد نثر و غزل',bio:'سعدی شیرازی شاعر و نویسنده بزرگ فارسی است که گلستان و بوستان او ستون‌های اخلاق و ادب فارسی‌اند.',works:'گلستان، بوستان، غزلیات',verses:['بنی‌آدم اعضای یکدیگرند','تو کز محنت دیگران بی‌غمی','به جهان خرم از آنم که جهان خرم از اوست']}
      ];
      function poetAt(i){if(i<basePoets.length)return basePoets[i];const n=i+1;return {name:`شاعر پارسی ${n}`,years:`${900+i%900}–${930+i%900}`,role:['غزلسرا','قصیده‌پرداز','مثنوی‌سرا','رباعی‌گو'][i%4],bio:`زندگی‌نامه پژوهشی ${n}: دوره زیست، ویژگی فکری، زبان شعری و جایگاه در سنت ادبی.`,works:`آثار شاخص ${n}: مجموعه اشعار و رساله‌های ادبی.`,verses:[`بیت ${n}-۱`,`بیت ${n}-۲`,`بیت ${n}-۳`]};}

      const grammarSeeds=[
        {t:'مفعول',sum:'کلمه‌ای که فعل روی آن انجام می‌شود',body:`<p><b>معنی مفعول:</b> مفعول یعنی کسی/چیزی که کار روی آن واقع می‌شود.</p><p><b>روش تشخیص:</b> پیش از فعل، سوال «چه‌کسی را/چه‌چیزی را؟» بپرسید.</p><table><tr><th>مثال</th><th>مفعول</th></tr><tr><td>او برادرش را به دانشگاه رساند.</td><td>برادرش</td></tr><tr><td>کتاب‌های من را بچین.</td><td>کتاب‌های من</td></tr><tr><td>گنجشک‌ها دانه‌ها را می‌خوردند.</td><td>دانه‌ها</td></tr><tr><td>چیزی می‌خورم.</td><td>چیزی</td></tr></table><p class='mini'>گام‌ها: ۱) فعل گذرا را بیاب ۲) پرسش «چه کسی را/چه چیزی را؟» ۳) پاسخ = مفعول.</p>`},
        {t:'نهاد',sum:'انجام‌دهنده یا دارنده حالت',body:`<p>برای یافتن نهاد، از فعل بپرسید «چه کسی/چه چیزی؟».</p><table><tr><th>جمله</th><th>نهاد</th></tr><tr><td>دانش‌آموز نوشت.</td><td>دانش‌آموز</td></tr><tr><td>باران بارید.</td><td>باران</td></tr></table>`},
        {t:'فعل',sum:'واژه‌ای که انجام کار یا حالت را می‌رساند',body:`<p>فعل از بن و شناسه ساخته می‌شود و زمان/وجه دارد.</p>`}
      ];
      const grammarTopics=Array.from({length:200},(_,i)=> i<grammarSeeds.length?grammarSeeds[i]:{t:`مبحث دستوری ${i+1}`,sum:'تعریف + روش تشخیص + مثال',body:`<p><b>تعریف:</b> توضیح کامل مبحث ${i+1}.</p><p><b>روش:</b> گام‌به‌گام شناسایی در جمله.</p><p><b>مثال:</b> نمونه کاربرد در نثر و شعر فارسی هشتم.</p>`});

      const literaryTopics=[
        {n:'کنایه',d:'آوردن عبارت با معنای نزدیک و دور که معنای دور مراد است.',k:'افزایش زیبایی معنایی، بیان غیرمستقیم و محترمانه.',ex:['از دهانش بوی شیر می‌آید = کم‌تجربه بودن','تیرش به سنگ خورد = موفق نشدن','پنبه از گوش درآوردن = خوب گوش دادن'],extra:`<table><tr><th>مکنی‌به</th><th>مکنی‌عنه</th></tr><tr><td>باز بودن در خانه</td><td>بخشنده بودن</td></tr><tr><td>انداختن سپر</td><td>تسلیم شدن</td></tr></table>`},
        {n:'تشبیه',d:'همسان‌سازی دو پدیده با ادات تشبیه.',k:'شفاف‌سازی و تصویرسازی.',ex:['چهره‌اش چون ماه است.','دل چون دریاست.'],extra:''},
        {n:'استعاره',d:'تشبیه فشرده بدون ادات.',k:'فشردگی و زیبایی بیان.',ex:['دست روزگار','غنچه لب'],extra:''}
      ];

      const roots=['آبگون','سپند','نیک‌سرشت','دادآیین','فرهمند','خجسته','رخشان','مهرورز'];
      function rareAt(i){const r=roots[i%roots.length],id=i+1;return {w:`${r}-${id}`,m:`معنی کامل: واژه‌ای پارسی برای اشاره به صفتی نیکو (شناسه ${id}).`,ex:`مثال: «او مردی ${r}-${id} بود که در سخن، ادب می‌ورزید.»`,txt:`در نثر ادبی، ${r}-${id} برای تقویت لحن فاخر به‌کار می‌رود. این واژه بار معنایی مثبت و فرهنگی دارد.`};}

      const samplePdfs=[
        {title:'نمونه سوال فارسی هشتم - درس ۱ تا ۳',content:'نمونه سوال فارسی هشتم\nدرس ۱ تا ۳\n۱) معنی واژه‌ها...'},
        {title:'نمونه سوال فارسی هشتم - دستور زبان',content:'نمونه سوال دستور زبان\nمبحث نهاد و مفعول\n...'},
        {title:'نمونه سوال فارسی هشتم - آرایه ادبی',content:'نمونه سوال آرایه\nکنایه، تشبیه، استعاره\n...'}
      ];

      const videos=[
        {t:'آموزش نهاد و مفعول',u:'https://www.aparat.com/video/video/embed/videohash/1a2b3c/vt/frame'},
        {t:'آرایه کنایه با مثال',u:'https://www.aparat.com/video/video/embed/videohash/4d5e6f/vt/frame'},
        {t:'شعرخوانی و تحلیل فارسی هشتم',u:'https://www.aparat.com/video/video/embed/videohash/7g8h9i/vt/frame'}
      ];

      const religions=[
        {n:'زرتشتی',era:'باستان تا امروز',gov:'هخامنشی/اشکانی/ساسانی',way:'دعا، نیایش، گفتار نیک/کردار نیک، آتشکده',desc:'دین ایرانی با تاکید بر راستی و مسئولیت اخلاقی.'},
        {n:'مانوی',era:'ساسانی',gov:'آغاز ساسانی',way:'ریاضت و آیین‌های معنوی',desc:'آیین مانی با خوانش دوگانه نور/ظلمت.'},
        {n:'اسلام',era:'سده ۱ هجری تا امروز',gov:'حکومت‌های ایرانی-اسلامی',way:'نماز، دعا، قرآن، عبادت جمعی',desc:'دین غالب در ایران با شاخه‌های مختلف.'}
      ];

      const govTypes={
        'شاهنشاهی':'نظام پادشاهی متمرکز با شاه در رأس قدرت.',
        'خلافت/سلطنت':'حکومت دینی-سیاسی با امیر/سلطان.',
        'جمهوری':'نظامی با ساختار قانونی و نهادهای انتخابی/انتصابی.'
      };
      const dyn=[
        {n:'هخامنشیان',y:'۵۵۰–۳۳۰ ق.م',leaders:'کوروش، داریوش، خشایارشا',type:'شاهنشاهی'},
        {n:'ساسانیان',y:'۲۲۴–۶۵۱ م',leaders:'اردشیر، شاپور، خسروان',type:'شاهنشاهی'},
        {n:'صفویان',y:'۱۵۰۱–۱۷۳۶ م',leaders:'شاه اسماعیل، شاه عباس',type:'شاهنشاهی'},
        {n:'قاجار',y:'۱۷۸۹–۱۹۲۵ م',leaders:'آقامحمدخان، ناصرالدین‌شاه',type:'شاهنشاهی'},
        {n:'پهلوی',y:'۱۹۲۵–۱۹۷۹ م',leaders:'رضاشاه، محمدرضاشاه',type:'شاهنشاهی'},
        {n:'جمهوری اسلامی',y:'۱۹۷۹–اکنون',leaders:'رهبران جمهوری اسلامی',type:'جمهوری'}
      ];

      const traitors=[
        {name:'پرونده تاریخی ۱: میر جعفر',did:'همراهی نظامی با قدرت خارجی علیه حاکم وقت',why:'رقابت قدرت',year:1757,type:'سیاسی/نظامی'},
        {name:'پرونده تاریخی ۲: ابن علقمی',did:'نقش بحث‌برانگیز در تضعیف ساختار سیاسی زمانه',why:'اختلافات داخلی',year:1258,type:'سیاسی'},
        {name:'پرونده تاریخی ۳: پرونده درباری قاجار',did:'واگذاری امتیازهای زیان‌بار',why:'بحران مالی و فشار خارجی',year:1890,type:'اقتصادی/سیاسی'},
        {name:'پرونده تاریخی ۴: همکاری اشغال',did:'همکاری با نیروی مهاجم در دوره جنگ',why:'منافع شخصی',year:1942,type:'نظامی'}
      ];

      const st={po:0,ra:0};
      const poetList=by('poetList'),grammarList=by('grammarList'),literaryList=by('literaryList'),rareList=by('rareList'),testList=by('testList'),videoRail=by('videoRail'),videoGrid=by('videoGrid'),player=by('player'),religionList=by('religionList'),historyRail=by('historyRail'),historyList=by('historyList'),traitorList=by('traitorList');

      function acc(scope){scope.querySelectorAll('.rowh').forEach(b=>b.onclick=()=>b.closest('.row').classList.toggle('open'));}

      function renderPoets(reset=true){const q=norm(by('poetSearch').value);if(reset){st.po=0;poetList.innerHTML='';}let c=0;while(st.po<TOTAL.poets&&c<PAGE.poets){const p=poetAt(st.po++);if(has([p.name,p.years,p.role,p.bio,p.works,...p.verses],q)){poetList.insertAdjacentHTML('beforeend',`<article class='row'><button class='rowh'>${p.name} — ${p.role}</button><div class='rowb'><p class='mini'>دوره زندگی: ${p.years}</p><p>${p.bio}</p><p><b>آثار:</b> ${p.works}</p><ul><li>${p.verses[0]}</li><li>${p.verses[1]}</li><li>${p.verses[2]}</li></ul></div></article>`);c++;}}
      acc(poetList);}

      function renderGrammar(){const q=norm(by('grammarSearch').value);const arr=grammarTopics.filter(g=>has([g.t,g.sum,g.body],q));grammarList.innerHTML=arr.map(g=>`<article class='row'><button class='rowh'>${g.t} — ${g.sum}</button><div class='rowb'>${g.body}</div></article>`).join('');acc(grammarList);}

      function renderLiterary(){const q=norm(by('literarySearch').value);const arr=literaryTopics.filter(l=>has([l.n,l.d,l.k,...l.ex,l.extra],q));literaryList.innerHTML=arr.map(l=>`<article class='row'><button class='rowh'>آرایه ${l.n} چیست؟</button><div class='rowb'><p><b>تعریف:</b> ${l.d}</p><p><b>کاربرد:</b> ${l.k}</p><p><b>مثال‌ها:</b></p><ul>${l.ex.map(x=>`<li>${x}</li>`).join('')}</ul>${l.extra}<img alt='نمودار ${l.n}' src="data:image/svg+xml;utf8,${encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='680' height='180'><rect width='100%' height='100%' fill='#f6fffb'/><circle cx='120' cy='90' r='45' fill='#c8f6e9'/><text x='92' y='96' font-size='20'>${l.n}</text><rect x='220' y='45' width='380' height='90' rx='12' fill='#d9ebff'/><text x='240' y='95' font-size='20'>تعریف + مثال + کاربرد</text></svg>`)}" style='max-width:100%;border:1px solid #bee5dc;border-radius:8px' /></div></article>`).join('');acc(literaryList);}

      function renderRare(reset=true){const q=norm(by('rareSearch').value);if(reset){st.ra=0;rareList.innerHTML='';}let c=0;while(st.ra<TOTAL.rare&&c<PAGE.rare){const w=rareAt(st.ra++);if(has([w.w,w.m,w.ex,w.txt],q)){rareList.insertAdjacentHTML('beforeend',`<article class='row'><button class='rowh'>${w.w}</button><div class='rowb'><p>${w.m}</p><p><b>مثال:</b> ${w.ex}</p><p class='mini'>${w.txt}</p></div></article>`);c++;}}acc(rareList);}

      function toDownloadUrl(text){return URL.createObjectURL(new Blob([text],{type:'application/pdf'}));}
      function getAdminFiles(){try{return JSON.parse(localStorage.getItem('grade8_pdfs')||'[]')}catch{return[]}}
      function saveAdminFiles(a){localStorage.setItem('grade8_pdfs',JSON.stringify(a));}

      function renderTests(){const q=norm(by('testSearch').value);const built=samplePdfs.map(s=>({title:s.title,url:toDownloadUrl(s.content),source:'نمونه آماده'}));const admin=getAdminFiles();const all=[...admin,...built].filter(i=>has([i.title,i.source||''],q));testList.innerHTML=all.map((t,i)=>`<article class='row'><button class='rowh'>${t.title}</button><div class='rowb'><p class='mini'>منبع: ${t.source||'ادمین'}</p><a class='btn' href='${t.url||t.data}' download='${t.title}.pdf'>دانلود PDF</a></div></article>`).join('');acc(testList);}

      function renderVideos(){const q=norm(by('videoSearch').value);const f=videos.filter(v=>has([v.t],q));videoRail.innerHTML=f.map((v,i)=>`<button class='chip' data-i='${i}'>${v.t}</button>`).join('');videoGrid.innerHTML=f.map((v,i)=>`<article class='vcard' data-i='${i}'><h3>${v.t}</h3><p class='mini'>برای پخش کلیک کنید</p></article>`).join('');const open=i=>{if(!f[i])return;player.innerHTML=`<h3>${f[i].t}</h3><iframe src='${f[i].u}' allowfullscreen loading='lazy'></iframe>`};videoRail.querySelectorAll('[data-i]').forEach(b=>b.onclick=()=>open(+b.dataset.i));videoGrid.querySelectorAll('[data-i]').forEach(b=>b.onclick=()=>open(+b.dataset.i));if(f.length)open(0);}

      function renderReligions(){const q=norm(by('religionSearch').value);const f=religions.filter(r=>has([r.n,r.era,r.gov,r.way,r.desc],q));religionList.innerHTML=f.map(r=>`<article class='row'><button class='rowh'>${r.n} — ${r.era}</button><div class='rowb'><p><b>حکومت‌های مرتبط:</b> ${r.gov}</p><p><b>راه ارتباطی با خدا/امر قدسی:</b> ${r.way}</p><p>${r.desc}</p></div></article>`).join('');acc(religionList);}

      function renderHistory(){const q=norm(by('historySearch').value);const f=dyn.filter(d=>has([d.n,d.y,d.leaders,d.type],q));historyRail.innerHTML=f.map((d,i)=>`<button class='chip' data-i='${i}'>${d.n}</button>`).join('');const open=i=>{const d=f[i];if(!d)return;historyList.innerHTML=`<article class='row open'><button class='rowh'>${d.n} — ${d.y}</button><div class='rowb' style='display:block'><p><b>شاهان/رهبران:</b> ${d.leaders}</p><p><b>نوع حکومت:</b> ${d.type}</p><p class='mini'><b>یعنی چه؟</b> ${govTypes[d.type]||'تعریف نوع حکومت در منابع تاریخ سیاسی.'}</p></div></article>`};historyRail.querySelectorAll('[data-i]').forEach(b=>b.onclick=()=>open(+b.dataset.i));if(f.length)open(0);else historyList.innerHTML='';}

      function renderTraitors(){const q=norm(by('traitorSearch').value),s=by('traitorSort').value,d=by('traitorDir').value;let arr=[...traitors].filter(t=>has([t.name,t.did,t.why,t.year,t.type],q));arr.sort((a,b)=>s==='year'?a.year-b.year:a.type.localeCompare(b.type,'fa'));if(d==='desc')arr.reverse();traitorList.innerHTML=arr.map(t=>`<article class='row'><button class='rowh'>${t.name} — سال ${t.year}</button><div class='rowb'><p><b>چه کار کرد:</b> ${t.did}</p><p><b>چرا:</b> ${t.why}</p><p><b>نوع:</b> ${t.type}</p></div></article>`).join('');acc(traitorList);}

      by('uploadBtn').onclick=()=>{if(by('adminUser').value.trim()!==USER||by('adminPass').value!==PASS)return alert('نام کاربری یا رمز اشتباه است.');const file=by('uploadFile').files[0],title=by('uploadTitle').value.trim();if(!file||!title)return alert('عنوان و فایل PDF لازم است.');const fr=new FileReader();fr.onload=()=>{const arr=getAdminFiles();arr.unshift({title,data:fr.result,source:'ادمین'});saveAdminFiles(arr);by('uploadTitle').value='';by('uploadFile').value='';renderTests();alert('فایل با موفقیت آپلود شد.');};fr.readAsDataURL(file);};

      by('globalSearch').oninput=()=>{const q=norm(by('globalSearch').value);const checks={
        poets:has([poetAt(0).name,poetAt(1).name],q), grammar:grammarTopics.some(g=>has([g.t,g.sum],q)), literary:literaryTopics.some(l=>has([l.n,l.d],q)), rare:has([rareAt(0).w,rareAt(1).w],q),
        tests:[...samplePdfs,...getAdminFiles()].some(t=>has([t.title],q))||!q, video:videos.some(v=>has([v.t],q)), religions:religions.some(r=>has([r.n,r.era],q)), history:dyn.some(h=>has([h.n,h.y],q)), traitors:traitors.some(t=>has([t.name,t.did,t.why],q)), admin:has(['ادمین آپلود ورود',USER],q)
      };document.querySelectorAll('.card').forEach(c=>c.style.display=checks[c.dataset.panel]?'block':'none');};

      by('poetSearch').oninput=()=>renderPoets(true);by('poetMore').onclick=()=>renderPoets(false);by('grammarSearch').oninput=renderGrammar;by('literarySearch').oninput=renderLiterary;by('rareSearch').oninput=()=>renderRare(true);by('rareMore').onclick=()=>renderRare(false);by('testSearch').oninput=renderTests;by('videoSearch').oninput=renderVideos;by('religionSearch').oninput=renderReligions;by('historySearch').oninput=renderHistory;by('traitorSearch').oninput=renderTraitors;by('traitorSort').onchange=renderTraitors;by('traitorDir').onchange=renderTraitors;

      const panels=[...document.querySelectorAll('.panel')];document.querySelectorAll('.card').forEach(c=>c.onclick=()=>{panels.forEach(p=>p.classList.remove('open'));by(`panel-${c.dataset.panel}`).classList.add('open');});document.querySelectorAll('[data-close]').forEach(b=>b.onclick=()=>b.closest('.panel').classList.remove('open'));

      renderPoets(true);renderGrammar();renderLiterary();renderRare(true);renderTests();renderVideos();renderReligions();renderHistory();renderTraitors();
    </script>
  </body>
</html>
